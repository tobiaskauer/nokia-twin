{"remainingRequest":"/Users/tk/GitHub/twin-dashboard/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tk/GitHub/twin-dashboard/src/components/vis.vue?vue&type=style&index=0&id=91b57380&scoped=true&lang=css&","dependencies":[{"path":"/Users/tk/GitHub/twin-dashboard/src/components/vis.vue","mtime":1592563626836},{"path":"/Users/tk/GitHub/twin-dashboard/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tk/GitHub/twin-dashboard/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/tk/GitHub/twin-dashboard/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/tk/GitHub/twin-dashboard/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tk/GitHub/twin-dashboard/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5saW5lcyBwYXRoIHsKICBmaWxsOiBub25lOwogIHN0cm9rZTogYmxhY2sKfQo="},{"version":3,"sources":["vis.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwIA;AACA;AACA;AACA","file":"vis.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"vis\" ref=\"vis\">\n    {{JSON.stringify(queries)}}\n    <svg :width=\"width\" :height=\"height\">\n      <path v-for=\"(result,index) in results\" v-bind:key=\"index\" :d=\"result.lines\" />\n    </svg>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport * as d3 from 'd3'\nimport { bus } from '../main'\n\n\nexport default {\n  name: 'vis',\n\n  data() {\n    return {\n      width: 700,\n      height: 800,\n      results: [],\n      scale: undefined,\n      queries : [\n        {\n          metric: undefined,\n          location: undefined,\n          company: undefined,\n          //country: undefined,\n          //role: undefined,\n        }, {\n          metric: undefined,\n          location: undefined,\n          company: undefined,\n          //role: \"\",\n          //country: \"\",\n        }\n      ],\n    }\n  },\n\n  created () { //get initial set of queries from sidebar (preselected entries)\n    bus.$on('initial', (parameter) => { //listen on EventBus for changed queries\n      if(parameter.selector == \"metric\") { //change global queries if the metric was changed\n        this.queries.forEach(query => {\n          query.metric = parameter.key //assin new parameter\n        })\n      } else {\n        this.queries[parameter.index][parameter.selector] = parameter.key //or jut change parameter if it's not the metric\n      }\n   })\n   this.queries.forEach((query,i) => this.getData(query,i))\n },\n\nmounted () { //when mounted\n   let svg = d3.select(\"#vis svg\")\n\n   this.scale = this.getScales();\n   svg.append(\"g\").attr(\"transform\", \"translate(0,100)\").call(d3.axisBottom(this.scale.x).ticks(5))\n   svg.append(\"g\").call(d3.axisLeft(this.scale.y).ticks(5))\n   this.lines = this.update(this.results)\n\n\n\n\n   //start listening on eventbus for updated\n   bus.$on('query', (parameter) => {\n     this.queries[parameter.index][parameter.selector] = parameter.key //change query\n     this.lastIndex = [parameter.index,parameter.selector] //change index to trigger watch-function\n     this.getData(this.queries[parameter.index],parameter.index) //get data for updated query\n  })\n},\n\nmethods: {\n  getData: function(query,i) {\n    axios.post( \"http://localhost:8080/nokia/nokia-twin/comparison-api.php?\",query,\n      {headers: {'Content-Type': 'application/json;charset=UTF-8'}\n    })\n    .then((response) => {\n      this.results[i] = {query: query, data: response.data, path: \"\"} //send response to this.result\n      console.log(results.length)\n    });\n  },\n\n  getScales: function() {\n    let parseTime = d3.timeParse(\"%Y-%m\");\n    const x = d3.scaleTime().range([0, 430]); //TODO: width\n    const y = d3.scaleLinear().range([210, 0]); //TODO: height\n    d3.axisLeft().scale(x);\n    d3.axisBottom().scale(y);\n\n\n\n  /*  let arr = []\n    let parseTime = d3.timeParse(\"%Y-%m\");\n    this.results.forEach(result => {\n      result.data.forEach(data =>\n        arr.push(data)\n      )\n    })*/\n\n\n\n    //x.domain(d3.extent(arr, d => parseTime(d.d)));\n    x.domain([parseTime(\"2000-01\"),parseTime(\"2020-12\")]);\n    //y.domain(d3.extent(arr, d => +d.r));\n    y.domain([0,5]);\n    return { x, y };\n  },\n\n  update: function(results) {\n\n    console.log(results)\n    console.log(results.length)\n    let parseTime = d3.timeParse(\"%Y-%m\");\n    let arr = []\n\n    const path = d3.line()\n    .curve(d3.curveBasis)\n     .x(d => this.scale.x(parseTime(d.d)))\n     .y(d => this.scale.y(d.r));\n\n     results.forEach(result => {\n       console.log(\"foo\")\n       arr.push(path(result.data))\n     })\n     console.log(arr)\n     return arr;\n  },\n}\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n.lines path {\n  fill: none;\n  stroke: black\n}\n</style>\n"]}]}